"use strict";var renderFilms,genres,inputValue,pageNumber=1,form=document.querySelector(".homePage__form"),input=document.querySelector(".homePage__input"),prevBtn=document.querySelector(".js-prev"),nextBtn=document.querySelector(".js-next"),homePlaginationNumber=document.querySelector(".homepage__page"),list=document.querySelector(".homePage__filmList"),popWhenError=document.querySelector(".homePage__error"),closeError=document.querySelector(".homePage__close-error-btn"),detailsPage=document.querySelector(".detailsPage");function fetchGenres(){fetch("https://api.themoviedb.org/3/genre/movie/list?api_key=f1943ebda4bde31f3353b960641d381f&language=en-US").then(function(e){return e.json()}).then(function(e){return genres=e.genres}).catch(function(e){return console.log(e)})}function createCards(e,t,n,a){var r=document.createElement("li");r.classList.add("homePage__filmItem","filmList__item");var i=document.createElement("img");i.classList.add("homePage__img","filmList__img"),i.setAttribute("src","https://image.tmdb.org/t/p/w500".concat(t));var o=document.createElement("p");o.classList.add("homePage__movieName","filmList__movieName");var c=getYearFromDate(n);return o.textContent="".concat(e," (").concat(c,")"),r.append(i,o),r.addEventListener("click",function(){return activeDetailsPage(a,!1)}),r}function getYearFromDate(e){return e.slice(0,4)}function getPopularMovies(){var t=document.createDocumentFragment();list.innerHTML="",fetch("https://api.themoviedb.org/3/movie/popular?api_key=f1943ebda4bde31f3353b960641d381f&language=en-US&page=".concat(pageNumber)).then(function(e){return e.json()}).then(function(e){e.results.forEach(function(e){t.append(createCards(e.title,e.backdrop_path,e.release_date,e.id))}),list.append(t),renderFilms=e.results})}function searchFilms(e){pageNumber=1,e.preventDefault(),inputValue=input.value,fetchMovies(),prevBtn.removeEventListener("click",getPopularMovies),nextBtn.removeEventListener("click",getPopularMovies),prevBtn.addEventListener("click",fetchMovies),nextBtn.addEventListener("click",fetchMovies),form.reset()}function fetchMovies(){var t=document.createDocumentFragment();list.innerHTML="",fetch("https://api.themoviedb.org/3/search/movie?api_key=f1943ebda4bde31f3353b960641d381f&language=en-US&page=".concat(pageNumber,"&include_adult=false&query=").concat(inputValue)).then(function(e){return e.json()}).then(function(e){e.results.length<1?incorrectInput():backToHomePage(),e.results.forEach(function(e){t.append(createCards(e.title,e.backdrop_path,e.release_date,e.id))}),list.append(t),renderFilms=e.results}).catch(function(e){return console.log(e)})}function incorrectInput(){popWhenError.classList.remove("main__hidden"),closeError.classList.remove("main__hidden"),closeError.addEventListener("click",showHomePage),prevBtn.classList.add("main__hidden"),nextBtn.classList.add("main__hidden"),homePlaginationNumber.classList.add("main__hidden")}function backToHomePage(){popWhenError.classList.add("main__hidden"),closeError.classList.add("main__hidden"),prevBtn.classList.remove("main__hidden"),nextBtn.classList.remove("main__hidden"),homePlaginationNumber.classList.remove("main__hidden")}function plaginationNavigation(e){"Next"===e.target.textContent&&(pageNumber+=1),"Prev"===e.target.textContent&&(pageNumber-=1),homePlaginationNumber.textContent=pageNumber,"1"===homePlaginationNumber.textContent?prevBtn.disabled=!0:prevBtn.disabled=!1}function initalBtnDisabling(){"1"===homePlaginationNumber.textContent&&(prevBtn.disabled=!0)}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}fetchGenres(),window.onload=showHomePage,prevBtn.addEventListener("click",plaginationNavigation),nextBtn.addEventListener("click",plaginationNavigation),form.addEventListener("submit",searchFilms);var selectFilm,homeBtn=document.querySelector(".js-home"),libraryBtn=document.querySelector(".js-library"),logo=document.querySelector(".header__logo"),homePage=document.querySelector(".homePage__block"),myFilmLibraryPage=document.querySelector(".myFilmLibraryPage");function showHomePage(){backToHomePage(),pageNumber=1,homePlaginationNumber.textContent=pageNumber,prevBtn.removeEventListener("click",fetchMovies),nextBtn.removeEventListener("click",fetchMovies),prevBtn.addEventListener("click",getPopularMovies),nextBtn.addEventListener("click",getPopularMovies),initalBtnDisabling(),getPopularMovies(),detailsPage.classList.add("main__hidden"),myFilmLibraryPage.classList.add("main__hidden"),homePage.classList.remove("main__hidden")}function showLibraryPage(){detailsPage.classList.add("main__hidden"),blankLibraryPage(),myFilmLibraryPage.classList.remove("main__hidden"),homePage.classList.add("main__hidden")}function activeDetailsPage(t,e){if(homePage.classList.add("main__hidden"),myFilmLibraryPage.classList.add("main__hidden"),detailsPage.classList.remove("main__hidden"),e){console.log("hello");var n=[];localStorage.getItem("watched")&&n.push.apply(n,_toConsumableArray(JSON.parse(localStorage.getItem("watched")))),localStorage.getItem("queue")&&n.push.apply(n,_toConsumableArray(JSON.parse(localStorage.getItem("queue")))),selectFilm=n.find(function(e){return e.id===t})}else selectFilm=renderFilms.find(function(e){return e.id===t});showDetails(selectFilm)}homeBtn.addEventListener("click",showHomePage),libraryBtn.addEventListener("click",showLibraryPage),logo.addEventListener("click",showHomePage);var toAddString,imgDetailsPage=document.querySelector(".detailsPage__img"),title=document.querySelector(".detailsPage__title"),vote=document.querySelector(".js-vote"),popularity=document.querySelector(".js-popularity"),originalTitle=document.querySelector(".js-originalTitle"),genre=document.querySelector(".js-genre"),about=document.querySelector(".js-about"),addToQueueBtn=document.querySelector(".js-addToQueue"),addToWatchedBtn=document.querySelector(".js-addToWatched"),removeFromWatchedBtnText='<i class="far fa-trash-alt detailsPage__icon"></i> <span class="detailsPage__btn">Remove from watched</span>',removeFromQueueBtnText='<i class="far fa-calendar-minus detailsPage__icon"></i> <span class="detailsPage__btn">Remove from queue</span>',addToWatchedBtnText='<i class="fas fa-video detailsPage__icon"></i> <span class="detailsPage__btn">Add to watched</span>',addToQueueBtnText='<i class="fas fa-calendar-plus detailsPage__icon"></i> <span class="detailsPage__btn">Add to queue</span>';function showDetails(e){imgDetailsPage.setAttribute("src","https://image.tmdb.org/t/p/original".concat(e.poster_path));var t=getYearFromDate(e.release_date);title.textContent="".concat(e.original_title," (").concat(t,")"),vote.textContent="".concat(e.vote_average,"/").concat(e.vote_count),popularity.textContent=e.popularity,originalTitle.textContent=e.original_title;var n=e.genre_ids.map(function(t){return genres.find(function(e){return e.id===t}).name}).join(", ");genre.textContent=n,about.textContent=e.overview,toggleTextBtn()}function addWatchedToLocaleStorage(){var e=[],t=localStorage.getItem("watched");if(t){var n=JSON.parse(t);if(n.find(function(e){return e.id===selectFilm.id}))return;n.push(selectFilm),toAddString=JSON.stringify(n)}else e.push(selectFilm),toAddString=JSON.stringify(e);localStorage.setItem("watched",toAddString),toggleTextBtn()}function addQueueToLocaleStorage(){var e=[],t=localStorage.getItem("queue");if(t){var n=JSON.parse(t);if(n.find(function(e){return e.id===selectFilm.id}))return;n.push(selectFilm),toAddString=JSON.stringify(n)}else e.push(selectFilm),toAddString=JSON.stringify(e);localStorage.setItem("queue",toAddString),toggleTextBtn()}function removeWatchedFromLocaleStorage(){var e=localStorage.getItem("watched"),t=JSON.parse(e).filter(function(e){return e.id!==selectFilm.id});toAddString=JSON.stringify(t),localStorage.setItem("watched",toAddString),toggleTextBtn()}function removeQueueFromLocaleStorage(){var e=localStorage.getItem("queue"),t=JSON.parse(e).filter(function(e){return e.id!==selectFilm.id});toAddString=JSON.stringify(t),localStorage.setItem("queue",toAddString),toggleTextBtn()}function toggleTextBtn(){var e=localStorage.getItem("watched"),t=localStorage.getItem("queue"),n=JSON.parse(t),a=JSON.parse(e);!function(){if(n){var e=n.find(function(e){return e.id===selectFilm.id});addToQueueBtn.innerHTML="".concat(e?removeFromQueueBtnText:addToQueueBtnText)}else addToQueueBtn.innerHTML="".concat(addToQueueBtnText)}(),function(){if(a){var e=a.find(function(e){return e.id===selectFilm.id});addToWatchedBtn.innerHTML="".concat(e?removeFromWatchedBtnText:addToWatchedBtnText)}else addToWatchedBtn.innerHTML="".concat(addToWatchedBtnText)}()}function toggleWatchedBtn(){" Add to watched"===addToWatchedBtn.textContent?addWatchedToLocaleStorage():" Remove from watched"===addToWatchedBtn.textContent&&removeWatchedFromLocaleStorage()}function toggleQueueBtn(){" Add to queue"===addToQueueBtn.textContent?addQueueToLocaleStorage():removeQueueFromLocaleStorage()}addToWatchedBtn.addEventListener("click",toggleWatchedBtn),addToQueueBtn.addEventListener("click",toggleQueueBtn);var watchButton=document.querySelector(".js-libraryWatchedBtn"),queueButton=document.querySelector(".js-libraryQueueBtn"),element=document.getElementById("libraryListTemplate"),noItemsToShow=document.querySelector(".myFilmLibraryPage__no-items"),libraryWatchedList=document.querySelector(".js-libraryWatchedList"),libraryQueueList=document.querySelector(".js-libraryQueueList");function showNoItems(){libraryQueueList.innerHTML="",libraryWatchedList.innerHTML="",noItemsToShow.classList.remove("main__hidden")}function blankLibraryPage(){libraryQueueList.innerHTML="",libraryWatchedList.innerHTML="",noItemsToShow.classList.add("main__hidden")}function fillLibraryList(e){var t=e.target,n=element.innerHTML.trim(),a=Handlebars.compile(n),r=t.textContent.toLowerCase(),i=localStorage.getItem(r);if(i){var o=JSON.parse(i);if(0<o.length){var c=a(o);"watched"===r?(libraryQueueList.classList.add("main__hidden"),noItemsToShow.classList.add("main__hidden"),libraryWatchedList.classList.remove("main__hidden"),libraryWatchedList.innerHTML="",libraryWatchedList.insertAdjacentHTML("afterbegin",c)):"queue"===r&&(noItemsToShow.classList.add("main__hidden"),libraryWatchedList.classList.add("main__hidden"),libraryQueueList.classList.remove("main__hidden"),libraryQueueList.innerHTML="",libraryQueueList.insertAdjacentHTML("afterbegin",c)),document.querySelectorAll(".myFilmLibraryPage__filmItem").forEach(function(e){return e.addEventListener("click",function(){return activeDetailsPage(parseInt(e.dataset.id))},!0)})}else showNoItems()}else showNoItems()}watchButton.addEventListener("click",function(e){return fillLibraryList(e)}),queueButton.addEventListener("click",function(e){return fillLibraryList(e)});